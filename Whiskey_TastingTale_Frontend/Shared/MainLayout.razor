@using Whiskey_TastingTale_Frontend.Services
@using Whiskey_TastingTale_Frontend.ViewModels
@using Whiskey_TastingTale_Frontend.Pages

@inherits LayoutComponentBase
@inject UserState State 
@inject PageState PageState
@inject NavigationManager NavigationManager
@inject SearchViewModel ViewModel
<MudThemeProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudAvatar>
            <MudImage Src="images/icon.png"></MudImage>
        </MudAvatar>
        <MudText Typo="Typo.h5" Class="ml-3">Whiskey_TT</MudText>
        <MudSpacer />
                <MudGrid Justify="Justify.Center" Style="padding: 20px;">
                    <MudItem xs="12" sm="6">
                <MudTextField @bind-Value="ViewModel.SearchWord" Placeholder="Search..." Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                                      OnKeyUp="@HandleKeyPress" />
                    </MudItem>
                </MudGrid>
                <MudSpacer />
        @{
            if(State.Token != null)
            {
                <MudButton Variant="Variant.Filled" Color="Color.Secondary">MyPage</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="HandleLogoutClicked">logout</MudButton>
            }
            else
            {
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="HandleLoginClicked">login</MudButton>
            }
        }
    </MudAppBar>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {

    private void HandleLoginClicked()
    {
        PageState.PriviousPage = "/" + NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.NavigateTo("/login", forceLoad:true);
    }

    private void HandleLogoutClicked()
    {
        State.init();
    }

    private void HandleKeyPress(KeyboardEventArgs args)
    {

        if (args.Key == "Enter")
        {
            NavigationManager.NavigateTo("/search", forceLoad:true);
        }
    }
}